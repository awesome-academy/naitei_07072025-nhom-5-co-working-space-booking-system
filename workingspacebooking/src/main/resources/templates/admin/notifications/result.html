<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin_layout}">
<head>
    <meta charset="UTF-8">
</head>
<body th:with="pageTitle=#{notification.result.title}">
<div layout:fragment="content">
    <h2 th:text="#{notification.result.title}">Notification Sending Result</h2>
    <hr class="text-secondary">

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-info">
                <div class="card-header">
                    <i class="fas fa-users"></i> <span th:text="#{notification.result.total.recipients}">Total Recipients</span>
                </div>
                <div class="card-body">
                    <h4 class="card-title" th:text="${result.totalRecipients()}">0</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-header">
                    <i class="fas fa-check-circle"></i> <span th:text="#{notification.result.success.count}">Sent Successfully</span>
                </div>
                <div class="card-body">
                    <h4 class="card-title" th:text="${result.successCount()}">0</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-danger">
                <div class="card-header">
                    <i class="fas fa-times-circle"></i> <span th:text="#{notification.result.failed.count}">Failed to Send</span>
                </div>
                <div class="card-body">
                    <h4 class="card-title" th:text="${result.failedCount()}">0</h4>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${result.successCount() > 0}" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span th:utext="#{notification.result.success.message(${result.successCount()})}">Success message</span>
    </div>

    <!-- Hiển thị chi tiết kết quả gửi email -->
    <div th:if="${!result.emailResults().isEmpty()}" class="mt-4">
        <h5 class="text-primary">
            <i class="fas fa-envelope"></i> <span th:text="#{notification.result.details.title}">Chi tiết kết quả gửi email</span>
        </h5>
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>#</th>
                                <th th:text="#{notification.result.table.name}">Tên người dùng</th>
                                <th th:text="#{notification.result.table.email}">Email</th>
                                <th th:text="#{notification.result.table.role}">Vai trò</th>
                                <th th:text="#{notification.result.table.status}">Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="emailResult, iterStat : ${result.emailResults()}">
                                <td th:text="${iterStat.count}">1</td>
                                <td th:text="${emailResult.name()}">User Name</td>
                                <td th:text="${emailResult.email()}">user@example.com</td>
                                <td>
                                    <span class="badge" 
                                          th:classappend="${emailResult.role() == 'ADMIN'} ? 'bg-danger' : 
                                                         (${emailResult.role() == 'OWNER'} ? 'bg-primary' : 'bg-secondary')"
                                          th:text="${emailResult.role()}">ROLE</span>
                                </td>
                                <td>
                                    <span th:if="${emailResult.success()}" class="badge bg-success">
                                        <i class="fas fa-check"></i> <span th:text="#{notification.result.status.success}">Success</span>
                                    </span>
                                    <span th:if="${!emailResult.success()}" class="badge bg-danger" 
                                          th:title="${emailResult.status()}">
                                        <i class="fas fa-times"></i> <span th:text="#{notification.result.status.failed(${emailResult.status()})}">Failed</span>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div th:if="${result.emailResults().size() > 50}" class="mt-2">
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i>
                        <span th:text="#{notification.result.showing.all(${result.emailResults().size()})}">Showing all recipients</span>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <a th:href="@{/admin/notifications/new}" class="btn btn-primary">
            <i class="fas fa-plus"></i> <span th:text="#{notification.result.button.send.another}">Send Another Notification</span>
        </a>
        <a th:href="@{/admin/dashboard}" class="btn btn-secondary ms-2">
            <i class="fas fa-tachometer-alt"></i> <span th:text="#{notification.result.button.dashboard}">Dashboard</span>
        </a>
    </div>
</div>
</body>
</html>
